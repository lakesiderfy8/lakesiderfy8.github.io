<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Progressive Taxation: Meeting the £40 Billion Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .flow-step {
            border-color: #0a9396;
            background-color: #ffffff;
        }
        .flow-arrow {
            color: #0a9396;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #005f73;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="container mx-auto p-4 md:p-8">

        <header class="text-center my-12">
            <h1 class="text-4xl md:text-6xl font-extrabold text-[#005f73] leading-tight">Meeting the Fiscal Challenge</h1>
            <p class="mt-4 text-lg md:text-xl text-slate-600 max-w-3xl mx-auto">A visual guide to progressive taxation options for the United Kingdom's £40 billion revenue requirement.</p>
        </header>

        <main class="space-y-16">

            <section id="challenge" class="text-center bg-white rounded-lg shadow-lg p-8">
                <h2 class="text-2xl font-bold text-[#005f73] mb-2">The Scale of the Challenge</h2>
                <p class="text-slate-600 mb-6">The UK government must raise substantial new revenue to stabilise public finances.</p>
                <div class="bg-[#005f73] text-white inline-block p-8 rounded-xl shadow-2xl">
                    <div class="text-7xl md:text-8xl font-black">£40B</div>
                    <div class="text-xl md:text-2xl font-semibold mt-2">Required Annually</div>
                </div>
            </section>

            <section id="lessons">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold text-[#005f73]">Why a Wealth Tax? Lessons from Europe</h2>
                    <p class="mt-2 text-slate-600 max-w-2xl mx-auto">The success or failure of a wealth tax hinges on its design. The key difference lies in the breadth of the tax base.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-xl font-semibold text-center text-[#0a9396] mb-4">Successful Models (e.g., Switzerland)</h3>
                        <div class="chart-container h-64 md:h-72">
                            <canvas id="successfulWealthTaxChart"></canvas>
                        </div>
                        <p class="text-center mt-4 text-sm text-slate-500">A comprehensive base with minimal exemptions ensures a stable and fair revenue stream, acting as a minimum tax on the wealthy.</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-xl font-semibold text-center text-[#ae2012] mb-4">Failed Models (e.g., France)</h3>
                        <div class="chart-container h-64 md:h-72">
                            <canvas id="failedWealthTaxChart"></canvas>
                        </div>
                        <p class="text-center mt-4 text-sm text-slate-500">Generous exemptions, especially for business assets, erode the tax base, rendering the tax ineffective and encouraging avoidance.</p>
                    </div>
                </div>
            </section>

            <section id="uk-proposals">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold text-[#005f73]">Two Paths for the UK: Annual vs. One-Off Levy</h2>
                    <p class="mt-2 text-slate-600 max-w-2xl mx-auto">Proposals for a UK wealth tax fall into two main categories, each with different revenue potentials and risks.</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                     <h3 class="text-xl font-semibold text-center text-slate-700 mb-4">Comparing Projected Annual Revenue</h3>
                    <div class="chart-container h-96">
                        <canvas id="ukProposalsChart"></canvas>
                    </div>
                    <p class="text-center mt-4 text-sm text-slate-500">The annual levy promises higher returns but is highly fragile, with 80% of its yield dependent on just 5,000 individuals. The one-off levy offers more certain, albeit temporary, revenue.</p>
                </div>
            </section>

            <section id="alternatives">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold text-[#005f73]">The Reliable Alternative: Reforming Existing Capital Taxes</h2>
                    <p class="mt-2 text-slate-600 max-w-2xl mx-auto">Before creating a new tax, substantial and more certain revenue can be raised by reforming current taxes on capital and wealth.</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold text-center text-slate-700 mb-4">Portfolio of Reforms vs. £40bn Target</h3>
                    <div class="chart-container h-96">
                        <canvas id="reformPortfolioChart"></canvas>
                    </div>
                    <p class="text-center mt-4 text-sm text-slate-500">A package of reforms targeting capital gains, investment income, and tax loopholes could raise the majority of the required revenue with higher certainty and lower administrative complexity.</p>
                </div>
            </section>

            <section id="gambling">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold text-[#005f73]">The Gambling Levy: A High-Risk Bet</h2>
                    <p class="mt-2 text-slate-600 max-w-2xl mx-auto">Increasing taxes on remote gambling is an option, but the revenue is highly uncertain and sensitive to consumer behaviour.</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold text-center text-slate-700 mb-4">Revenue Uncertainty from Gambling Duty Hikes</h3>
                    <div class="chart-container">
                        <canvas id="gamblingRevenueChart"></canvas>
                    </div>
                    <p class="text-center mt-4 text-sm text-slate-500">Optimistic forecasts (low elasticity) suggest billions in revenue, but more realistic models (high elasticity) show that aggressive tax hikes could yield significantly less and risk growing the unregulated black market.</p>
                </div>
            </section>

            <section id="strategy">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold text-[#005f73]">A Recommended Path Forward</h2>
                    <p class="mt-2 text-slate-600 max-w-2xl mx-auto">A multi-pronged, phased strategy offers the most prudent and effective path to meeting the £40 billion fiscal requirement.</p>
                </div>
                <div class="p-6">
                    <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4">
                        <div class="flow-step border-2 rounded-lg p-4 w-full md:w-1/3 text-center shadow-md">
                            <div class="font-bold text-lg text-[#005f73]">Phase 1: Short-Term (Year 1)</div>
                            <p class="text-sm text-slate-600 mt-1">Maximise revenue from existing tax structures (~£25-30 Billion)</p>
                        </div>
                        <div class="text-4xl font-light flow-arrow transform rotate-90 md:rotate-0">&rarr;</div>
                        <div class="flow-step border-2 rounded-lg p-4 w-full md:w-1/3 text-center shadow-md">
                            <div class="font-bold text-lg text-[#005f73]">Phase 2: Medium-Term (Years 2-5)</div>
                            <p class="text-sm text-slate-600 mt-1">Implement a One-Off Capital Levy (~£10-15 Billion)</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="gemini-brainstorm">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold text-[#005f73]">✨ Policy Brainstorm</h2>
                    <p class="mt-2 text-slate-600 max-w-2xl mx-auto">Go beyond the report. Use the Gemini API to generate creative, unconventional policy ideas for raising revenue without impacting the working and middle classes.</p>
                </div>
                <div class="text-center">
                    <button id="generateIdeasBtn" class="bg-[#0a9396] hover:bg-[#005f73] text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                        Generate Novel Ideas
                    </button>
                </div>
                <div id="ideasResult" class="mt-8">
                    <div id="loader" class="hidden loader"></div>
                    <div id="ideasContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </div>
            </section>

        </main>

        <footer class="text-center mt-16 py-6 border-t border-slate-200">
            <p class="text-sm text-slate-500">Infographic based on the report "Meeting the £40 Billion Challenge: A Strategic Assessment of Progressive Taxation Options for the United Kingdom".</p>
        </footer>

    </div>

    <script>
        const tooltipTitleCallback = {
            plugins: {
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const item = tooltipItems[0];
                            let label = item.chart.data.labels[item.dataIndex];
                            if (Array.isArray(label)) {
                              return label.join(' ');
                            } else {
                              return label;
                            }
                        }
                    }
                }
            }
        };

        function wrapLabels(label, maxLength = 16) {
            if (label.length <= maxLength) {
                return label;
            }
            const words = label.split(' ');
            const lines = [];
            let currentLine = '';
            words.forEach(word => {
                if ((currentLine + word).length > maxLength) {
                    lines.push(currentLine.trim());
                    currentLine = '';
                }
                currentLine += word + ' ';
            });
            lines.push(currentLine.trim());
            return lines;
        }

        new Chart(document.getElementById('successfulWealthTaxChart'), {
            type: 'doughnut',
            data: {
                labels: ['Taxable Base', 'Exemptions'],
                datasets: [{
                    data: [95, 5],
                    backgroundColor: ['#0a9396', '#e9d8a6'],
                    borderColor: '#ffffff',
                    borderWidth: 4,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: tooltipTitleCallback.plugins.tooltip
                },
                cutout: '70%'
            }
        });

        new Chart(document.getElementById('failedWealthTaxChart'), {
            type: 'doughnut',
            data: {
                labels: ['Taxable Base', 'Exemptions (e.g., Business Assets)'],
                datasets: [{
                    data: [60, 40],
                    backgroundColor: ['#94d2bd', '#ae2012'],
                    borderColor: '#ffffff',
                    borderWidth: 4,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: tooltipTitleCallback.plugins.tooltip
                },
                cutout: '70%'
            }
        });

        new Chart(document.getElementById('ukProposalsChart'), {
            type: 'bar',
            data: {
                labels: ['Annual Levy (2% on >£10m)', 'One-Off Levy (5% on >£500k)'],
                datasets: [
                    {
                        label: 'At-Risk Revenue',
                        data: [19.2, 0], 
                        backgroundColor: '#ee9b00',
                        stack: 'Stack 0',
                    },
                    {
                        label: 'More Certain Revenue',
                        data: [4.8, 52],
                        backgroundColor: '#0a9396',
                        stack: 'Stack 0',
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Projected Annual Revenue (£ Billions)'
                        }
                    },
                    y: {
                        stacked: true,
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: {
                        ...tooltipTitleCallback.plugins.tooltip,
                        mode: 'index',
                        intersect: false
                    }
                }
            }
        });

        const reformLabels = [
            'Equalise Capital Gains with Income Tax',
            'Apply NI to Investment Income',
            'Abolish Non-Dom Regime',
            '4% Tax on Share Buybacks',
            'Close IHT Loopholes'
        ];

        new Chart(document.getElementById('reformPortfolioChart'), {
            type: 'bar',
            data: {
                labels: ['Portfolio of Reforms'],
                datasets: [
                    { label: reformLabels[0], data: [13], backgroundColor: '#005f73' },
                    { label: reformLabels[1], data: [9.4], backgroundColor: '#0a9396' },
                    { label: reformLabels[2], data: [3.2], backgroundColor: '#94d2bd' },
                    { label: reformLabels[3], data: [2.2], backgroundColor: '#e9d8a6' },
                    { label: reformLabels[4], data: [1.4], backgroundColor: '#ee9b00' }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { stacked: true },
                    y: { 
                        stacked: true,
                        beginAtZero: true,
                        max: 40,
                        title: {
                            display: true,
                            text: 'Projected Annual Revenue (£ Billions)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: {
                        ...tooltipTitleCallback.plugins.tooltip,
                        mode: 'index',
                        intersect: false
                    },
                    annotation: {
                        annotations: {
                            line1: {
                                type: 'line',
                                yMin: 40,
                                yMax: 40,
                                borderColor: '#ae2012',
                                borderWidth: 2,
                                borderDash: [6, 6],
                                label: {
                                    content: '£40bn Target',
                                    enabled: true,
                                    position: 'end'
                                }
                            }
                        }
                    }
                }
            }
        });

        new Chart(document.getElementById('gamblingRevenueChart'), {
            type: 'line',
            data: {
                labels: ['10%', '20%', '30%', '40%', '50%'],
                datasets: [{
                    label: 'Optimistic Forecast (Low Elasticity)',
                    data: [0.5, 1.1, 1.8, 2.5, 3.2],
                    borderColor: '#0a9396',
                    backgroundColor: 'rgba(10, 147, 150, 0.2)',
                    fill: true,
                    tension: 0.3
                }, {
                    label: 'Pessimistic Forecast (High Elasticity)',
                    data: [0.4, 0.8, 1.1, 1.3, 1.5],
                    borderColor: '#ae2012',
                    backgroundColor: 'rgba(174, 32, 18, 0.2)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Projected Revenue (£ Billions)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Hypothetical Tax Rate Increase'
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: tooltipTitleCallback.plugins.tooltip
                }
            }
        });

        const generateIdeasBtn = document.getElementById('generateIdeasBtn');
        const loader = document.getElementById('loader');
        const ideasContainer = document.getElementById('ideasContainer');

        generateIdeasBtn.addEventListener('click', generatePolicyIdeas);

        async function generatePolicyIdeas() {
            loader.classList.remove('hidden');
            ideasContainer.innerHTML = '';
            generateIdeasBtn.disabled = true;

            const prompt = `Generate 3 creative, unconventional, and specific policy ideas for the UK government to raise significant revenue towards a £40 billion target. These policies must be designed to avoid impacting the working and middle classes. Focus on areas like corporate taxation, high-net-worth individuals, luxury goods, or financial transactions. For each idea, provide a short, catchy title and a 2-3 sentence explanation. Format the output as a numbered list. For example: 1. **Title:** Explanation.`;

            try {
                const responseText = await callGeminiWithBackoff(prompt);
                displayIdeas(responseText);
            } catch (error) {
                ideasContainer.innerHTML = `<p class="text-center text-red-500 col-span-full">Failed to generate ideas. Please try again later.</p>`;
            } finally {
                loader.classList.add('hidden');
                generateIdeasBtn.disabled = false;
            }
        }

        async function callGeminiWithBackoff(prompt, retries = 3, delay = 1000) {
            const apiKey = "AIzaSyCYkqbpqOxDGUKrUddBLnUqPLlANcvJEto";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        throw new Error('Invalid response structure from API.');
                    }
                } catch (error) {
                    if (i === retries - 1) throw error;
                    await new Promise(res => setTimeout(res, delay));
                    delay *= 2;
                }
            }
        }

        function displayIdeas(text) {
            const ideas = text.split(/\d\.\s/).filter(idea => idea.trim() !== '');
            ideas.forEach(ideaText => {
                const match = ideaText.match(/\*\*(.*?)\*\*:\s*(.*)/s);
                if (match) {
                    const title = match[1];
                    const description = match[2];
                    const ideaCard = `
                        <div class="bg-white rounded-lg shadow-md p-6 transform hover:-translate-y-2 transition-transform duration-300">
                            <h4 class="font-bold text-lg text-[#005f73]">${title}</h4>
                            <p class="text-slate-600 text-sm mt-2">${description}</p>
                        </div>
                    `;
                    ideasContainer.innerHTML += ideaCard;
                }
            });
        }

    </script>
</body>
</html>
